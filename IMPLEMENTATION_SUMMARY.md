# Popera Group Chat & Event Behavior - Complete Implementation Summary

## Files Created

1. **`data/fakeHosts.ts`** (UPDATED)
   - 10 fake hosts (2 per city: Vancouver, Toronto, Montreal, Calgary, Ottawa)
   - Each host has realistic profile, bio with demo disclaimer, use case

2. **`data/fakeEvents.ts`** (NEW)
   - 10 fake events (1 per fake host)
   - Coherent titles, descriptions, images matching host use case
   - Mix of free and paid events
   - All marked `isFakeEvent: true`

3. **`components/events/FakeEventReservationModal.tsx`** (NEW)
   - Modal for fake event reservation attempts
   - "Browse other events" CTA

4. **`components/chat/DemoEventBlocker.tsx`** (NEW)
   - Blocker for fake event chat access

5. **`components/chat/GroupChatHeader.tsx`** (NEW)
   - New conversation header with host info

6. **`POPERA_GROUP_CHAT_UPDATE.md`** (NEW)
   - Detailed technical documentation

## Files Modified

7. **`App.tsx`**
   - Uses `generateFakeEvents()` instead of old mock events
   - Initializes 10 fake events after Popera events

8. **`pages/EventDetailPage.tsx`**
   - Fake event reservation blocking with modal
   - Chat button locked for fake events

9. **`components/chat/GroupChat.tsx`** (MAJOR UPDATE)
   - Host/participant/demo view detection
   - Host tools bar (polls, announcements, surveys)
   - Image upload support
   - New header integration
   - Message styling (host vs participant)
   - Demo event blocking

10. **`components/chat/ChatReservationBlocker.tsx`**
    - Updated text: "Group conversation available only after reservation"
    - Updated CTA: "Reserve to access this conversation"

---

## How Fake Hosts and Events Are Represented

### Data Structure
- **Fake Hosts**: Array in `data/fakeHosts.ts`
  - 2 hosts per city × 5 cities = 10 hosts
  - Each has: id, name, username, email, bio (with demo disclaimer), profileImageUrl, city, useCase

- **Fake Events**: Generated by `generateFakeEvents()` in `data/fakeEvents.ts`
  - 1 event per host = 10 events
  - Key field: `isFakeEvent: true`
  - Linked to host via `hostId`

### Identification
- Fake events identified by: `event.isFakeEvent === true`
- Fake hosts identified by: `host.isDemo === true` (in FAKE_HOSTS array)

---

## View Type Determination

### Logic (in `GroupChat.tsx`)
```typescript
const isFakeEvent = event.isFakeEvent === true;
const isHost = currentUser && currentUser.id === event.hostId;
const hasReserved = currentUser ? currentUser.rsvps.includes(event.id) : false;
const isPoperaOwned = event.isPoperaOwned === true || event.hostId === POPERA_HOST_ID;

const viewType = isFakeEvent 
  ? 'demo'           // Always blocked
  : isHost 
  ? 'host'           // Host tools visible
  : (isPoperaOwned || hasReserved) 
  ? 'participant'   // Can read/send
  : 'blocked';       // Reservation blocker
```

### View Types

1. **Demo View** (`isFakeEvent === true`)
   - Always shows `DemoEventBlocker`
   - No messages, no input
   - Applies to all users

2. **Host View** (`currentUser.id === event.hostId` AND not fake)
   - Host tools bar visible
   - Can create polls, announcements, surveys
   - Messages right-aligned with orange accent
   - Can send text and images

3. **Participant View** (`hasReserved === true` OR `isPoperaOwned === true`)
   - No host tools
   - Can read and send messages/images
   - Messages left-aligned, white background

4. **Blocked View** (not reserved, not Popera-owned, not fake)
   - Shows `ChatReservationBlocker`
   - "Reserve to access this conversation" CTA

---

## Reservation Blocking Logic

### Fake Events
**Location**: `pages/EventDetailPage.tsx` → `handleRSVP()`

**Flow**:
1. User clicks "Reserve Spot"
2. Check: `if (isFakeEvent)`
3. Show `FakeEventReservationModal`
4. Modal message: "This is an example Popera event and cannot be reserved..."
5. "Browse other events" → routes to feed
6. No reservation performed
7. Attendee count unchanged

### Real Events
- Normal reservation flow unchanged
- RSVP updates user's `rsvps` array
- Attendee count increases for Popera events

---

## Group Conversation Blocking Logic

### 1. Fake Events (Demo View)
**Condition**: `isFakeEvent === true`

**Behavior**:
- Always shows `DemoEventBlocker` overlay
- Message: "This is a demo event. Group chat is only available for real, upcoming events."
- No messages displayed
- No input field
- Applies to ALL users (including fake host)

### 2. Non-Reserved Users (Real Events)
**Condition**: `!isFakeEvent && !canAccessChat` (not reserved, not Popera-owned)

**Behavior**:
- Shows `ChatReservationBlocker` overlay
- Message: "Group conversation available only after reservation"
- CTA: "Reserve to access this conversation"
- Clicking CTA:
  - If logged out → Auth pop-up → then reservation
  - If logged in → Immediate reservation
- After reservation: Blocker removed, chat loads, user stays on page

### 3. Popera Events
**Condition**: `isPoperaOwned === true`

**Behavior**:
- Chat always open (no reservation needed)
- Shows pinned message explaining open chat

### 4. Hosts (Real Events)
**Condition**: `currentUser.id === event.hostId` AND not fake

**Behavior**:
- Always has access (no reservation needed)
- Sees host view with tools
- Can send messages/images

---

## Confirmation

### ✅ Real Events' Reservation and Chat Flows Still Work
- Real events can be reserved normally
- Reservation increases attendee count for Popera events
- Chat access granted after reservation
- Popera events have open chat
- Hosts always have access

### ✅ Fake Events Behave as Demo-Only
- Reservation blocked with modal
- Chat always blocked with demo message
- No messages, no input
- Attendee count static
- Applies to all users (including fake host)

### ✅ Host Tools Only Visible to Hosts
- Host tools bar only shown when `isHost === true`
- Participants don't see host tools
- Blocked users don't see host tools
- Demo events don't show host tools

### ✅ Participants Can Send Text and Photos
- Participants can send text messages
- Participants can upload and send images
- Image upload button visible in input area
- Messages display correctly with proper styling

### ✅ New Conversation Header Visible and Consistent
- Header shows on all views (host/participant/demo)
- "Group conversation" title visible
- Host photo, name, and badge displayed
- Consistent across mobile and desktop
- Replaces old Popera logo header

---

## Summary

All requirements have been implemented:

1. ✅ **Fake Hosts & Events**: 2 hosts per city, 1 event each, all coherent
2. ✅ **Reservation Blocking**: Fake events show modal, real events work normally
3. ✅ **Group Chat Logic**: Host/participant/demo views with proper blockers
4. ✅ **Header Redesign**: New header with host info, consistent across views
5. ✅ **Message Types**: Text and image support for hosts and participants
6. ✅ **Host Tools**: Only visible to hosts, includes polls/announcements/surveys

No existing features were broken. All changes are minimal and focused on the requested behavior.


